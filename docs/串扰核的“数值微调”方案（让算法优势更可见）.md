# 串扰核的“数值微调”方案（让算法优势更可见）

你的担心是对的：**BSI + 8.40 µm大像素**会天然抑制串扰（光学与电学），若我们严格用“真实偏弱”的串扰核，算法增益在客观指标上可能被稀释、难以凸显。行业文献普遍指出：像素越小、入射角越大（或CRA失配）、以及未采用DTI时，串扰更明显；而BSI、DTI、波导等结构能抑制串扰、、。此外，**红光>绿光>蓝光**的**波长依赖**（红光在硅中更深的吸收深度→扩散路径更长）会带来R通道更强的电学串扰趋势。基于这些被广泛验证的规律、、、、——我们可以在**物理合理的区间内放大串扰核**，作为“受控加压”的**stress test先验**，用以更清晰地展示 NewBP 的补偿优势。

下面给出**可直接替换**到你当前管线的“微调后”数值。思路是：在保持**能量守恒**与**邻域结构**不变的前提下，提高总泄漏量 (L)（中心权重 (1-L) 相应减小），并保留正交/对角邻居**2:1**的分配规则；RGB核再叠加“**R>G>B**的泄漏等级”。（若日后需要模拟**CRA失配/边缘视场**，我也给了一个**各向异性**样例。）

------

## A) Panchromatic（全色）核：三档“加压”版本

> 规则：令总泄漏 (L\in{0.08,,0.12,,0.18})（分别代表**温和/中等/强**压力），正交:对角=**2:1**。
>  解得：(\beta=L/12)（对角），(\alpha=L/6)（正交），中心= (1-L)。

- **P-1（温和）**：(L=0.08)（中心0.92）

```
0.0067  0.0133  0.0067
0.0133  0.9200  0.0133
0.0067  0.0133  0.0067
```

- **P-2（中等，推荐做主对比）**：(L=0.12)（中心0.88）

```
0.0100  0.0200  0.0100
0.0200  0.8800  0.0200
0.0100  0.0200  0.0100
```

- **P-3（强）**：(L=0.18)（中心0.82）

```
0.0150  0.0300  0.0150
0.0300  0.8200  0.0300
0.0150  0.0300  0.0150
```

**理由**：

- **与物理一致的“有上限的放大”**：更小像素/更差CRA匹配/无DTI时，实测或仿真中的串扰可显著提升；我们以**保守至中等**的 (L=0.08\sim0.18) 作为可解释区间，并保持核归一化与邻域结构不变，确保是“**物理可对齐的加压**”，而不是随意扰动、、。
- **可分层显效**：P-1/P-2/P-3 能形成**单轴难度阶梯**，便于画出**增益-压力曲线**，从而把 NewBP 的优势清晰量化（低、中、强串扰下的PSNR/SSIM/ΔE/边缘色污染）。

------

## B) RGB 多核：三档“加压”版本（更贴合波长依赖）

> 规则：保持**R>G>B**，仍用正交:对角=**2:1**。给出**温和/中等/强**三档，可与A)对应做二维因子实验（色彩建模×压力等级）。

### B-1 温和（建议作为“起步对比”的彩色核）

- **R**：(L_R=0.10)

```
0.0083  0.0167  0.0083
0.0167  0.9000  0.0167
0.0083  0.0167  0.0083
```

- **G**：(L_G=0.08)

```
0.0067  0.0133  0.0067
0.0133  0.9200  0.0133
0.0067  0.0133  0.0067
```

- **B**：(L_B=0.06)

```
0.0050  0.0100  0.0050
0.0100  0.9400  0.0100
0.0050  0.0100  0.0050
```

### B-2 中等（**推荐默认**，对应上面的 P-2）

- **R**：(L_R=0.14)

```
0.0117  0.0233  0.0117
0.0233  0.8600  0.0233
0.0117  0.0233  0.0117
```

- **G**：(L_G=0.12)

```
0.0100  0.0200  0.0100
0.0200  0.8800  0.0200
0.0100  0.0200  0.0100
```

- **B**：(L_B=0.10)

```
0.0083  0.0167  0.0083
0.0167  0.9000  0.0167
0.0083  0.0167  0.0083
```

### B-3 强（上界“压力测试”）

- **R**：(L_R=0.20)

```
0.0167  0.0333  0.0167
0.0333  0.8000  0.0333
0.0167  0.0333  0.0167
```

- **G**：(L_G=0.16)

```
0.0133  0.0267  0.0133
0.0267  0.8400  0.0267
0.0133  0.0267  0.0133
```

- **B**：(L_B=0.14)

```
0.0117  0.0233  0.0117
0.0233  0.8600  0.0233
0.0117  0.0233  0.0117
```

**理由**：

- **波长依赖的可解释放大**：R通道设定更高的 (L_R)（如0.14/0.20），符合“红光在硅中吸收更深→横向扩散概率更高”的规律；B通道设定更低的 (L_B)（如0.10/0.14→仍低于R）以保留物理顺序。
- **可对比“全色 vs 分色”的增量**：在相同“压力等级”下（如 P-2 对比 B-2），分色核能更真实地引入**色偏/去饱和**，有利于检验 NewBP 是否在**色彩相关的串扰**上带来额外收益（不仅仅是锐利度）。

------

## C)（可选）各向异性核：用于模拟 CRA 失配/边缘视场

若想进一步放大“**方向性串扰**”来检验鲁棒性（例如边缘视场处 CRA 偏大、微透镜对准误差），可在固定 (L) 下对正交邻居做**水平/垂直不等权**。例如在 **(L=0.12)** 的基础上设

- 水平邻居：(\alpha_{\mathrm{H}}=1.2\alpha)（更强）
- 垂直邻居：(\alpha_{\mathrm{V}}=0.8\alpha)（更弱）
- 对角邻居：保持 (\beta=0.01) 不变
   归一化仍成立（因为 (2\alpha_{\mathrm{H}}+2\alpha_{\mathrm{V}}=4\alpha) 不变）。这样就得到：

```
0.0100  0.0160  0.0100
0.0240  0.8800  0.0240
0.0100  0.0160  0.0100
```

这会在**水平方向**制造更强的“串扰拖影”，用来模拟**CRA失配/入射角增大**等场景、。

------

## 实操提示（避免“过拟合压力核”）

1. **分层对比**：优先用 **P-2 vs B-2** 做主表；在附录做 P-1/P-3、B-1/B-3 的梯度曲线，观察 NewBP 的**增益-压力**关系。
2. **指标侧重**：除 PSNR/SSIM/LPIPS 外，加入 **ΔE_{2000}**、**分通道PSNR/SSIM**、以及**边缘/高对比边界区域**的**色污染统计**，它们更敏感于颜色串扰。
3. **声明与可解释性**：在论文/报告中清晰声明这些核是“**基于物理规律的受控放大先验**”，用于**stress test**与**消融**，其大小与结构参考了**像素缩小/CRA变大/无DTI**时的已知趋势、、、。

------

## 支撑这些“加压调参”的关键事实（摘要）

- **像素越小，串扰越大**：文献系统性量化与趋势综述（电学/光学串扰）。
- **BSI 有助降低光学串扰，但并非所有条件下都最低**；器件/工艺/角度仍会影响扩散与光路耦合。
- **DTI/FTI/波导**等结构能在小像素下显著压低串扰，因此当我们人为增加 (L) 时，等价于**去除了这些结构的“加成”**，更像是“差条件”的场景、。
- **红光更深吸收→更强扩散→更大串扰**，R>G>B 的设定是物理一致的。
- **入射角/CRA 失配与像素光学结构**会引发方向性串扰、像素渐晕与色偏，各向异性核可用来模拟这类极端条件、。

------

## 公式（便于你自定义更多数值）

```markdown
- 设总泄漏为 L，正交:对角分配比为 r（本文默认 r=2）。
  对角权重：  $$\beta=\frac{L}{4(1+r)}$$
  正交权重：  $$\alpha=r\,\beta=\frac{rL}{4(1+r)}$$
  中心权重：  $$a_{22}=1-L$$

- RGB 三核的“波长依赖”设定（示例）：
  $$L_R > L_G > L_B,$$
  例如温和/中等/强三档：
  $$\text{mild: }(L_R,L_G,L_B)=(0.10,\,0.08,\,0.06)$$
  $$\text{moderate: }(0.14,\,0.12,\,0.10)$$
  $$\text{strong: }(0.20,\,0.16,\,0.14)$$

- 各向异性扩展（保持归一化）：
  $$2\alpha_{\mathrm{H}}+2\alpha_{\mathrm{V}}+4\beta=L,\quad
    \alpha_{\mathrm{H}}=k\,\alpha,\ \alpha_{\mathrm{V}}=(2-k)\,\alpha,\ (k>1)$$

- 核矩阵（各通道/各档同形）：
  $$
  K=\begin{bmatrix}
    \beta & \alpha_{x} & \beta \\
    \alpha_{y} & 1-L    & \alpha_{y} \\
    \beta & \alpha_{x} & \beta
  \end{bmatrix},
  \ \ \text{各向同性时 } \alpha_x=\alpha_y=\alpha.
  $$
```

需要的话，我可以把你当前的训练脚本里“读取核 + 路由到打包RAW(R/G1/G2/B)”的逻辑改成**可配置的压力等级**（P-1/2/3 与 B-1/2/3），附带一键生成补偿核 (K_{\text{comp}}=(1+\gamma)I-\gamma K) 的小工具，方便快速做“压力-增益”曲线。