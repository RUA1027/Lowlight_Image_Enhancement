# 串扰卷积核推导

## 全色核

### 全色（Panchromatic）串扰卷积核的推导

基于对索尼IMX235AQL传感器物理特性的深刻理解，我们可以着手推导一个能够量化其串扰行为的数学模型。本节将推导一个全色（单通道）串扰核，它代表了传感器对所有颜色平均的、总体的空间响应特性。

#### **建模框架与约束条件**

像素串扰的物理过程在信号处理层面可以被高效地建模为一个**线性的、空间不变的（LSI）系统**。这意味着串扰效应对传感器上每个位置的像素都是相同的，并且可以用一个简单的二维离散卷积运算来表示。

考虑到串扰效应的高度局域性（信号主要泄漏至紧邻的像素），使用一个**3x3的卷积核**足以精确地捕捉其核心影响。该核的通用形式为：
$$
K_{crosstalk} =

\begin{pmatrix}

a_{11} & a_{12} & a_{13} \\

a_{21} & a_{22} & a_{23} \\

a_{31} & a_{32} & a_{33}

\end{pmatrix}
$$
其中，中心权重$a_{22}$代表被中心像素正确收集的信号比例（信号保留系数），而周围的八个权重则代表从中心像素泄漏至相应邻居的信号比例（信号泄漏系数）。

一个基本的物理约束是**电荷守恒原理**。

在理想情况下，所有由光子产生的电荷最终都会被某个像素收集。

这意味着**卷积核中所有元素的总和必须等于1。**
$$
\sum_{i=1}^{3} \sum_{j=1}^{3} a_{ij} = 1
$$


#### **第一步：估算总信号泄漏率与中心权重**

推导中最关键的一步是确定一个合理的总信号泄漏率。

综合分析显示，IMX235AQL传感器同时具备两个极有利于抑制串扰的特性：**8.40 μm的超大像素间距和背照式（BSI）技术架构。**

**前者极大地抑制了电学串扰，后者则显著减少了光学串扰。**

基于这些物理特性，一个合理的、保守的估计是，该传感器的**总信号泄漏率为6%**。

这意味着，当光信号聚焦于单个像素时，有94%的能量被该像素正确捕获，而总计6%的能量泄漏给了周围的八个邻居。

由此，我们可以直接确定卷积核的中心权重
$$
a_{22} = 1 - 0.06 = 0.94
$$

#### **第二步：分配泄漏信号权重**

余下的6%信号需要被合理地分配给周围的八个邻居像素。

载流子扩散的物理模型表明，泄漏概率与距离相关。四个正交方向的邻居（上、下、左、右）比四个对角线方向的邻居距离中心更近，因此会接收到更大部分的泄漏信号。

一个物理上非常合理的简化假设是，泄漏到正交邻居的信号量（记为$\alpha$）是泄漏到对角邻居的信号量（记为$\beta$）的两倍。基于此，我们可以建立一个方程组来求解

1. **总泄漏约束**: 
   $$
   4\alpha + 4\beta = 0.06
   $$

2. **分配比例约束**: 
   $$
   \alpha = 2\beta
   $$

将第二个方程代入第一个方程进行求解，由此可得$\alpha与\beta$的值：
$$
\beta = 0.005\qquad

\alpha = 0.01
$$

#### **最终的全色串扰核**

将计算出的中心权重、正交邻居权重和对角邻居权重组合在一起，便得到了最终的全色串扰卷积核。

该核精确地描述了一个系统：**94%的信号被保留，1%的信号泄漏到每个正交邻居，0.5%的信号泄漏到每个对角邻居。**

**推导出的索尼IMX235AQL传感器3x3全色串扰核**

|        | 左    | 中        | 右    |
| ------ | ----- | --------- | ----- |
| **上** | 0.005 | 0.010     | 0.005 |
| **中** | 0.010 | **0.940** | 0.010 |
| **下** | 0.005 | 0.010     | 0.005 |

## RGB混色核



### 结果（用于前向物理建模的 3×3 卷积核）

- **红色像素核 ($K_R$)**（长波长→更强扩散，设总串扰 ($L_R\approx7%$)）：

```text
0.006  0.012  0.006
0.012  0.930  0.012
0.006  0.012  0.006
```

四舍五入自 ($\beta_R\approx0.0058,\ \alpha_R\approx0.0117,\ a_{22,R}=0.93$)。

该矩阵与文件中给出的 Red 核一致，作为R通道的先验。

- **绿色像素核 ($K_G$)**（中等波长，设总串扰 ($L_G\approx6%$)）：

```text
0.005  0.010  0.005
0.010  0.940  0.010
0.005  0.010  0.005
```

$(\beta_G=0.005,\ \alpha_G=0.01,\ a_{22,G}=0.94)。与全色核一致，用于两片G（G1/G2）像素。$

- **蓝色像素核 ($K_B$)**（短波长→更浅吸收，设总串扰 ($L_B\approx5%$)）：

```text
0.004   0.0085  0.004
0.0085  0.950   0.0085
0.004   0.0085  0.004
```

四舍五入自 $(\beta_B\approx0.0042,\ \alpha_B\approx0.0083,\ a_{22,B}=0.95)$。

与文件中给出的 Blue 核一致，作为B通道的先验。

------

### 推导过程（逐步）

**Step 0：物理背景与建模假设**

- **波长依赖**：红光（~650 nm）在硅中吸收更深，横向扩散（电学串扰）概率更高；蓝光（~450 nm）近表面吸收，扩散最弱；绿光居中 → 预期**R>G>B** 的总串扰强度。
- **近邻主导 + 各向同性**：串扰主要落在**3×3**邻域，等距像素权重相同；正交邻居强于对角邻居。以**2:1**作为正交:对角的经验分配比。
- **能量守恒（电荷守恒）**：核系数和为1。

**Step 1：为每个通道设定总串扰比例 (L_c)**
 结合“大像素（8.40 µm）→低串扰”的基线与波长依赖，取
$$
L_R=0.07,\qquad L_G=0.06,\qquad L_B=0.05
 
$$
对应中心保留 (a_{22,c}=1-L_c) 分别为 **0.93 / 0.94 / 0.95**

这一取值区间与文档中的通道化推导一致，用以体现R/G/B的相对强弱。

**Step 2：建立邻居分配方程（每个通道独立）**
 设每个通道 ($c\in{R,G,B}$) 的**正交邻居**权重为 ($\alpha_c$)，**对角邻居**权重为 ($\beta_c$)，则
$$
\text{(a) 归一化约束：}\quad 4\alpha_c+4\beta_c=L_c,
$$

$$
\text{(b) 距离比假设：}\quad \alpha_c=2\beta_c.
$$

$$
\beta_c=L_c/12,\ \alpha_c=L_c/6
$$

**Step 3：求解并四舍五入到工程可用小数**

- **Red**：
  $$
  \beta_R=0.07/12\approx0.005833\Rightarrow\mathbf{0.0058!\to!0.006}，\\
   \alpha_R=0.07/6\approx0.011667\Rightarrow\mathbf{0.0117!\to!0.012}，\\
   a_{22,R}=1-0.07=\mathbf{0.93}
  $$

- **Green**：
  $$
  \beta_G=0.06/12=\mathbf{0.005}，\\\alpha_G=0.06/6=\mathbf{0.010}，\\a_{22,G}=\mathbf{0.94}
  $$

- **Blue**：
  $$
  beta_B=0.05/12\approx0.004167\Rightarrow\mathbf{0.0042}，\\
   \alpha_B=0.05/6\approx0.008333\Rightarrow\mathbf{0.0085}，\\
   a_{22,B}=\mathbf{0.95}
  $$

**Step 4：矩阵组装与归一化检查**
 对每个通道均有
$$
K_c=\begin{bmatrix}
 \beta_c & \alpha_c & \beta_c\\
 \alpha_c & a_{22,c} & \alpha_c\\
 \beta_c & \alpha_c & \beta_c
 \end{bmatrix},\qquad
 a_{22,c}+4\alpha_c+4\beta_c=1\ \ (\checkmark).
$$
